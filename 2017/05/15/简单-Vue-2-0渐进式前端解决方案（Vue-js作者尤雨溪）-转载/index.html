<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vue2.0,转载,es6," />





  <link rel="alternate" href="/atom.xml" title="殖民的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/f.ico?v=5.1.1" />






<meta name="description" content="(转载) 本人的新博客上线了：https://sky-xsk.github.io/ 主流框架分析我们看一下现有的一些主流框架从少到多所解决的问题。这个多少并不是来评价框架的好坏，而是从设计的角度出发看它涵盖多少内容。">
<meta name="keywords" content="vue2.0,转载,es6">
<meta property="og:type" content="article">
<meta property="og:title" content="简单-Vue 2.0渐进式前端解决方案（Vue.js作者尤雨溪）(转载)">
<meta property="og:url" content="http://sky-xsk.github.io/2017/05/15/简单-Vue-2-0渐进式前端解决方案（Vue-js作者尤雨溪）-转载/index.html">
<meta property="og:site_name" content="殖民的博客">
<meta property="og:description" content="(转载) 本人的新博客上线了：https://sky-xsk.github.io/ 主流框架分析我们看一下现有的一些主流框架从少到多所解决的问题。这个多少并不是来评价框架的好坏，而是从设计的角度出发看它涵盖多少内容。">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-407dc7f60ed1d67e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-72b56c882d9e0928.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-cbbd5445f7dc238c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-b2bd278fee9930b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-f5318b26fd379db8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-bab8386ad22743e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-e637288e2605bd6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-39da1f251705df15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-ae606217fafa1da3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-6fa04bd4fa157483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-1c8dfe606eeeb0c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-94aa654696b9489b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-e8042cb7949e252f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/4155235-95887005d88183f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-05-18T16:07:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="简单-Vue 2.0渐进式前端解决方案（Vue.js作者尤雨溪）(转载)">
<meta name="twitter:description" content="(转载) 本人的新博客上线了：https://sky-xsk.github.io/ 主流框架分析我们看一下现有的一些主流框架从少到多所解决的问题。这个多少并不是来评价框架的好坏，而是从设计的角度出发看它涵盖多少内容。">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/4155235-407dc7f60ed1d67e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://sky-xsk.github.io/2017/05/15/简单-Vue-2-0渐进式前端解决方案（Vue-js作者尤雨溪）-转载/"/>





  <title>简单-Vue 2.0渐进式前端解决方案（Vue.js作者尤雨溪）(转载) | 殖民的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0b6637084bfaebb9774949026f4134c6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">

  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">殖民的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Don't Be Same！Be Better！</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
        
      
        
        <li class="menu-item menu-item-about">
          <a href="/abouts/about.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
        
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
        
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
        
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
        
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>
<p style="text-align: center; margin:3px;"><button onclick="TogetherJS(this); return false;" style="background:#FA5555;border:0; color:#ffffff; text-align: center">获取实时帮助,<b>耐心等待</b>右下角的弹窗哦！</button></p>
<p style="text-align:center;  margin:0px;"><span style="background:#67C23A; font-size:12px; padding:5px; color:#ffffff;">介绍一下用法：当点击按钮后，会弹出一个url，把url复制给你的好友，你们就可以相互操作页面了，还可以聊天，语音哦！关闭再点击一下按钮即可！</span></p>
<div id="music163player">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=200  src="//music.163.com/outchain/player?type=2&id=38358214&auto=0&height=66">
    </iframe>
</div>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://sky-xsk.github.io/2017/05/15/简单-Vue-2-0渐进式前端解决方案（Vue-js作者尤雨溪）-转载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="殖民">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/headers.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="殖民的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">简单-Vue 2.0渐进式前端解决方案（Vue.js作者尤雨溪）(转载)</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-15T23:09:28+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">阅读量 <i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  4,670
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  16
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><code>(转载)</code></p>
<p>本人的新博客上线了：<br><a href="https://sky-xsk.github.io/">https://sky-xsk.github.io/</a></p>
<p><strong>主流框架分析</strong><br>我们看一下现有的一些主流框架从少到多所解决的问题。这个多少并不是来评价框架的好坏，而是从设计的角度出发看它涵盖多少内容。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-407dc7f60ed1d67e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br> <a id="more"></a><br>纯模板引擎：最少的就是纯模板引擎，只管状态到界面的映射。</p>
<p>React和Vue：其实这两者都是非常专注的只做状态到界面映射，以及组件。</p>
<p>Backbone：它会给你多一些架构上指导，比如它会让你分层。</p>
<p>Angular：它做的事情就更多，它有自己的路由，这些都会包含在里面。</p>
<p>Ember：相比Angular，Ember做得就更加彻底，Ember信奉的是约定优于配置，它会将一切都帮你设计好打包好，你就开箱用就可以了。</p>
<p>Meteor：Meteor只是一个极端，它是从前到后全都包含，从前端到数据层到数据库，全都帮你打包好。</p>
<p>通过简单的分析，我们可以感受到，做得少的框架不一定就不如做得多的框架，这体现出一种取舍。也就是说，做得少的框架可以给你更多的灵活性，但你需要做更多的选择；做得多的框架有更强的侵入性，学习成本更高，灵活性更低。一旦选择了一个侵入性强的框架，那么一些小的部分你就没有机会去切换成其他你更想用的方案。<br><strong>Vue的定位</strong>与其他框架的区别就是渐进式的想法，也就是“Progressive”——这个词在英文中定义是渐进，一步一步，不是说你必须一竿子把所有的东西都用上。<br><strong>Vue的设计</strong>接下来我们回到之前看的图：<br><img src="http://upload-images.jianshu.io/upload_images/4155235-72b56c882d9e0928.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Vue从设计角度来讲，虽然能够涵盖这张图上所有的东西，但是你并不需要一上手就把所有东西全用上，因为没有必要。无论从学习角度，还是实际情况，这都是可选的。声明式渲染和组建系统是Vue的核心库所包含内容，而客户端路由、状态管理、构建工具都有专门解决方案。这些解决方案相互独立，你可以在核心的基础上任意选用其他的部件，不一定要全部整合在一起。<br><strong>Vue的实现</strong>接下来深入讲一讲这些具体的概念以及Vue在这些概念上具体是做怎样的实现。<br>(1) 声明式渲染<br>现在基本所有的框架都已经认同这个看法——<strong>DOM应尽可能是一个函数式到状态的映射</strong>状态即是唯一的真相，而Dom状态只是数据状态的一个映射，所有的逻辑应该尽量在状体的层面上去进行，当状态改变的时候，View应该是在框架帮助下自动更新到合理的状态，而不是当观察到数据变化后手动的选择元素再命令式改动它的属性下图是Vue的一个模板示例，如果没有用过Vue的话，可以大概感觉到这是一个怎样的概念<br><img src="http://upload-images.jianshu.io/upload_images/4155235-cbbd5445f7dc238c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">声明式渲染</p>
<p>其实，在模板语法上，Vue跟Angular是比较相似。在Vue1.0里面，模板实现跟Angular类似，如下图所示，把模板直接做成在浏览器里面parse成DOM树，然后去遍历这个树，提取其中的各种绑定。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-b2bd278fee9930b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">aa.png</p>
<p>在Vue2.0中，渲染层的实现做了根本性改动，引入了虚拟DOM<br>从架构上讲，2.0依然写同样的模板，在最左边，Vue2.0跟1.0的模板语法绝大部分是兼容的。Vue的编译器在编译模板之后，会把这些模板编译成一个渲染函数。而函数被调用的时候就会渲染并且返回一个虚拟DOM的树。这个树非常轻量，它的职责就是描述当前界面所应处的状态。当我们有了这个虚拟的树之后，再交给一个patch函数，负责把这些虚拟DOM真正施加到真实的DOM上。<br>在这个过程中，Vue有自身的响应式系统来侦测在渲染过程中所依赖到的数据来源。在渲染过程中，侦测到的数据来源之后，之后就可以精确感知数据源的变动。到时候就可以根据需要重新进行渲染。当重新进行渲染之后，会生成一个新的树，将新树与旧树进行对比，就可以最终得出应施加到真实DOM上的改动。最后再通过patch函数施加改动。<br><strong>这样做的主要原因是，在浏览器当中，JavaScript的运算在现代的引擎中非常快，但DOM本身是非常缓慢的东西。当你调用原生DOM API的时候，浏览器需要在JavaScript引擎的语境下去接触原生的DOM的实现，这个过程有相当的性能损耗。所以，本质的考量是，要把耗费时间的操作尽量放在纯粹的计算中去做，保证最后计算出来的需要实际接触真实DOM的操作是最少的。</strong><br>下面看渲染函数。用过React的开发者可能知道，React是没有模板的，直接就是一个渲染函数，它中间返回的就是一个虚拟DOM树。JSX实际就是一套用于让我们更简单地去描述树状结构的语法糖如下图所示，在Vue2.0当中，可以看到就是说当比如左侧的模板，经过Vue的编译之后就会变成右侧的东西。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-f5318b26fd379db8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>此函数类似于创建一个虚拟元素的函数，我们可以给它一个名字，给它描述应该有的属性特性和可能其他的数据。然后后面这个最后这个参数是个数组，包含了该虚拟元素的子元素。总的来说2.0的编译器做的就是这个活。<br>同时，在Vue2.0里，<strong>用户可以选择直接跳过模板这一层去手写渲染函数，同时也有可选JSX支持</strong>。从开发者的偏好以及开发者的效益的角度来考量，模板和JSX是各有利弊的东西。模板更贴近我们的HTML，可以让我们更直观地思考语义结构，更好地结合CSS的书写。<br>JSX和直接渲染函数，因为是真正的JavaScript，拥有这个语言本身的所有的能力，可以进行复杂的逻辑判断，进行选择性的返回最终要返回的DOM结构，能够实现一些在模板的语法限制下，很难做到的一些事情。<br>所以在Vue2.0里，两个都是可以选择的。<strong>在绝大部分情况下使用模板，但是在需要复杂逻辑的情况下，使用渲染函数</strong>。在Vue2.0的路由和内部的一些实践上，都大量地应用渲染函数做复杂的抽象组件，比如<strong>过渡动画组件以及路由里面的link组件，都是用渲染函数实现的</strong>，同时还保留了它本身的依赖追踪系统。<br><strong>举例</strong><br>在渲染函数里面用到A.B的时候，这个就会触发对应的 getter。整个渲染流程具体要点如下：<br>当某个数据属性被用到时，触发 getter，这个属性就会被作为依赖被 watcher 记录下来。<br>整个函数被渲染完的时候，每一个被用到的数据属性都会被记录。<br>相应的数据变动时，例如给它一个新的值，就会触发 setter，通知数据对象对应数据有变化。<br>此时会通知对应的组件，其数据依赖有所改动，需要重新渲染。<br>对应的组件再次调动渲染函数，生成 Virtual DOM，实现 DOM 更新。</p>
<p>这样一个流程跟主流的一些框架，例如React是有较大区别的。在React中，当组件复杂的时候需要用 shouldComponentUpdate 做优化。但是，它也有自己的各种坑，比如要确保该组件下面的组件不依赖外部的状态。虽说这在大部分情况下是够用的，但遇到极大复杂度的应用，遇到性能瓶颈的时候，这个流程优化起来也是相当复杂的一个话题。<br>如下图所示，在Vue里面由于依赖追踪系统的存在，当任意数据变动的时，Vue的每一个组件都精确地知道自己是否需要重绘，所以并不需要手动优化。用Vue渲染这些组件的时候，数据变了，对应的组件基本上去除了手动优化的必要性。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-bab8386ad22743e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">2.png</p>
<p>（2）组件系统<br>相信基本上所有的现代框架都已经走向了组件化道路，Web Components 从规范层面做这个实践。主流框架都有各有不同的封装，但核心思想都是一样，<strong>把UI结构映射到恰当的组件树。</strong><br>在Vue中，<strong>父子组件之间的通信是通过 props 传递。从父向子单向传递；而如果子组件想要在父组件作用里面产生副作用，就需要去派发事件</strong>。这样就形成一个基本的父子通信模式，在涉及大规模状态管理的时候会有额外的方案，这个后面会提到<br>Vue的组件引入构建工具之后有一个单文件组件概念，如下图所示，就是这个Vue文件。在同一个Vue文件里，可以同时写 template、script 和 style，三个东西放在一个里面。<br>同时，<strong>Vue的单文件组件和 Web Components 有一个本质不同，它是基于构建工具实现</strong>。这样的好处是有了一个构建的机会，可以对这些单文件组件做更多的分析处，在每一个语言块里可以单独使用不同的处理器，这点后面还会讲到。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-e637288e2605bd6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">单文件组件</p>
<p>（3）客户端路由<br>在做一个界面复杂度非常的高应用时，它会有很多的状态，这样的应用显然不可能在每做一次操作后都刷新一个页面作为用户反馈。这就要这个应用有多个复杂的状态，同时这些状态还要对应到URL。<br>有一个重要的功能叫做 <strong>deep-linking，也就是当用户浏览到一个URL，然后把它传给另外的人或者复制重新打开，应用需要直接渲染出这个URL对应的状态</strong>。这就意味着应用的URL和组件树的状态之间有一个映射关系，<strong>客户端路由的职责就是让这个映射关系声明式地对应起来</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-39da1f251705df15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>可能同一层的路由有多个不同的出口，还有着复杂的URL匹配规则，等等。这些问题如果都由自己去一一实现，那么复杂度是非常高的。而Vue基本都有对应的解决方案（router.vuejs.org）。配合Webpack还可以实现基于路由的懒加载，<strong>一条路径所对应的组件在打包的时候，会分离成另外一块，只有当该路由被访问的时候，才会被加载出来</strong>。这有相应的解决方案，同时也有实例。<br>（4）状态管理<br>说到状态管理，本质上就是把整个应用抽象为下图中的循环。脸书最早提出 Flux 这个概念的时，也是一个很松散的概念，而且官方的实现本身做得很难用。所以，社区就做了各种各样的探索。<strong>图中的这三个东西是一个单向数据流，State 驱动 View 的渲染，而用户对 View 进行操作产生 Action，会使State产生变化，从而导致 View 重新渲染</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-ae606217fafa1da3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>一个单独的Vue的组件，其实就已经是这样的结构。但是当多个这样的组件来配套的时候，就会遇到一个问题。每个组件都有它自己的状态，但整个应用的状态，跟组件之间并不一定存在一一对应的关系。这个状态可能是一个全局状态。那么状态到底放在哪里？<strong>大部分解决方案是把这个状态从组件树中提取出来，放在一个全局的 Store 里面。Vuex 也是这样做的，但是它是针对 Vue 做了特化</strong><br>我们看到最左边就是Vue的组件，这些组件在大部分情况下，就不再有私有的状态，而是从全局的 Store 里面获取状态。Actions 和 Mutations 比较难用一两句话说清楚，<strong>大致就是当应用状态进行改变的时候，需要通过 Mutations 去显式地触发，而 Actions 则是负责异步和其他副作用</strong>。<br>由于 Mutations 会被记录下来，我们可以把这些记录发到工具里面去做分析，甚至进行回滚。当发现bug的时候，这使得我们可以更好地理解大型应用中的状态变化。更多的细节，还请看官方文档（vuex.vuejs.org）。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-6fa04bd4fa157483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">6.png</p>
<p>（5）构建工具<br>构建工具方面，Vue有一个官方的，<strong>全局安装的 vue-cli。</strong>这里有一个笔误。全局安装之后，我们就可以用 vue 命令创建一个新的项目，<strong>Vue 的 CLI 跟其他 CLI 不同之处在于，有多个可选模板，有简单的也有复杂的。极简的配置，更快的安装，可以更快的上手。</strong><br>它也有一个更完整的模板，包括单元测试在内的各种内容都涵盖，但是，它的复杂度也更高，这又涉及到根据用例来选择恰当复杂度的问题。所有的模板在创建之后，构建脚本都是通过 npm 脚本来执行，在国内安装 npm 依赖的时候有点卡，可以用 yarn 或者推荐用淘宝的 npm 镜象源，可以很大地提升安装速度。<br>之前提到了单文件组件，如下图所示，支持任意的处理器，开箱即用的热重载，所以组件都支持热重载 (hot-reload)。当你做了修改，不会刷新页面，只是对组件本身进行立刻重载，不会影响整个应用当前的状态。CSS也支持热重载。<br>我们看下左下角，在使用这个预处理器的同时，我们只需要添加一个 scoped 特性，Vue 会通过对模板和CSS代码的解析改写，来模拟CSS的效果。<strong>同时单文件组件也支持懒加载，一个懒加载的组件和它的依赖会被打包成一个额外的包，只有被用到的时候才加载</strong>，这对首屏的加载速度也是很有帮助的。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-1c8dfe606eeeb0c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">1.png</p>
<p>如下图所示，这个开发者工具本身也是用Vue写的<br><img src="http://upload-images.jianshu.io/upload_images/4155235-94aa654696b9489b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">2.png</p>
<p>使用它的话可以看到我们当前应用的组件树结构。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-e8042cb7949e252f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">3.png</p>
<p>点击组件，就可以观察这个组件当前的状态。也可以把这个组件发送到控制台里。同时这个开发者工具还有一个 Vuex 面板，如果你用了 Vuex，那么每次操作都会被记录下来，记录下来的状态之间可以进行跳转。<br>除此之外，<strong>还支持把当前应用的状态快照发送给另外一个人，这个人可以在他的控制台里导入你发送的状态，就可以立刻跳转到你之前所在的状态。这对于重现一些 bug，或要描述当前状态都很有帮助</strong>。<br>Vue2.0<br>Vue2.0在不久之前刚刚发布（具体报道参见<a href="http://t.cn/RVC0foZ%EF%BC%89%EF%BC%8C%E4%B9%8B%E5%89%8D%E4%B8%80%E4%BA%9B%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82%E5%9C%A8%E5%89%8D%E6%96%87%E4%B8%AD%E5%B7%B2%E6%9C%89%E6%89%80%E6%B6%89%E5%8F%8A%E3%80%82Vue2.0%E7%9B%B8%E5%AF%B9%E4%BA%8E1.0%E7%9A%84%E6%94%B9%E8%BF%9B%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%82%B9%E3%80%82" target="_blank" rel="external">http://t.cn/RVC0foZ），之前一些技术细节在前文中已有所涉及。Vue2.0相对于1.0的改进有以下几点。</a><br>1、更轻<br>对Vue1.0大小压缩，Vue2.0它有一个只包含运行时的版本，所有的模板在编译的时候已经完成了。基于这个版本，下图中Vue、vue-router和vuex三个（都是 2.0 版本）加一起，跟Vue1.0的核心库大小一样。<br>2、更快<br>Vue2.0可以说是当前最快的框架之一。这个是基于第三方独立测试的结果。有兴趣的话，可以<a href="http://stefankrause.net/js-frameworks-benchmark4/webdriver-ts/table.html" target="_blank" rel="external">移步链接</a>进行查看。<br>这个测试是一个比较综合的测试，它对于各种操作，以及在大列表里面更新移除等，都有相当完整的覆盖。可以看出，Vue2.0，不仅仅是在Vue1.0的基础上有很大提升，相比其他框架，也有相当明显的性能优势。<br>3、Vue2.0 架构<br>下图是Vue2.0的架构图，这里不深入讲整个架构的实现。<br><img src="http://upload-images.jianshu.io/upload_images/4155235-95887005d88183f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Vue2.0同时支持服务端，服务端渲染支持流式渲染。因为HTTP请求也是流式，Vue 的服务端渲染结果可以直接 pipe 到返回的请求里面。这样一来，就可以更早地在浏览器中呈现给用户内容，通过合理的缓存策略，可以有效地提升服务端渲染的性能。<br>除了服务端渲染还有原生渲染，这里的原生渲染是指阿里巴巴的项目Weex。在架构层面，通过编译一个 Weex 源文件（类似于 Vue 单文件组建的格式）然后运行。界面节点的操作都是抽象的，这些抽象操作会派发到不同的目标引擎做实际的渲染，同时支持 iOS, Android 和 Web。<br>Vue和Weex现在有一个合作，Vue 2.0 将会正式成为 Weex 的 JavaScript 运行时。这样的合作可以使得符合功能交集的Vue组件可以跨平台使用。<br><code>(转载)</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">本人的github，里面有vue2.0的小项目练习，包括仿饿了么的客户端，vue2.0写的，基本功能已经实现，部分bug在修改中;如果觉得有用的话，请给个“star”；</div><div class="line">https://github.com/sky-xsk</div></pre></td></tr></table></figure></p>
<blockquote>
<p></p><p>访客的ip和所在地址：<b id="vositor" style="color:red"></b>  访问时间: <b id="vositortimes" style="color:red"></b> 当前时间: <b id="vositortime" style="color:red"></b></p><p></p>
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
<script type="text/javascript">
     var add = document.getElementById('vositor').innerHTML=returnCitySN['cip'] + ' , ' + returnCitySN['cname']; 
      function sTime(){ 
      var d = new Date(); 
      var s = d.getHours();
      var m = d.getMinutes();
      var se = d.getSeconds();
      if(s<10){
         s="0"+s; 
      }else if(m<10){
          m="0"+m; 
      }else if(se<10){
          se="0"+se; 
      }
      var tt = s +":"+ m +":"+ se; 
      document.getElementById("vositortime").innerText = tt;
      return tt; 
      } 
      var showTime = setInterval(sTime,1000);   
      function getDate(){
          var ts = sTime();
          document.getElementById("vositortimes").innerText = ts;
      }
      getDate();
</script></blockquote>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/xskewm.jpg" alt="殖民 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号</div>
</div>


      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>打赏不在多少，请鼓励一下！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wx.png" alt="殖民 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/1494766982934.jpg" alt="殖民 Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      殖民
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://sky-xsk.github.io/2017/05/15/简单-Vue-2-0渐进式前端解决方案（Vue-js作者尤雨溪）-转载/" title="简单-Vue 2.0渐进式前端解决方案（Vue.js作者尤雨溪）(转载)">http://sky-xsk.github.io/2017/05/15/简单-Vue-2-0渐进式前端解决方案（Vue-js作者尤雨溪）-转载/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue2-0/" rel="tag"># vue2.0</a>
          
            <a href="/tags/转载/" rel="tag"># 转载</a>
          
            <a href="/tags/es6/" rel="tag"># es6</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/11/vue2-0-自己开发一个全局定义的公用组件（插件）/" rel="next" title="vue2.0,自己开发一个全局定义的公用组件（插件）">
                <i class="fa fa-chevron-left"></i> vue2.0,自己开发一个全局定义的公用组件（插件）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/16/怎么理解-forEach-call-？/" rel="prev" title=" 怎么理解[].forEach.call()？">
                 怎么理解[].forEach.call()？ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODY1Ny81MjI4"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>
  
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
      

      
      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/headers.png"
               alt="殖民" />
          <p class="site-author-name" itemprop="name">殖民</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sky-xsk" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/2fb92d7e3f03" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5362683665/home?wvr=5&sudaref=graph.qq.com" target="_blank" title="新浪微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  新浪微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://user.qzone.qq.com/871855637/infocenter?ptsig=oVI05tNefxuMfj1TzR1I-WoNWxHU8aHaTlkzapJe*RI_" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  QQ空间
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://shang.qq.com/email/stop/email_stop.html?qq=871855637&sig=a1c657365db7e82805ea4b2351081fc3ebcde159f8ae49b1&tttt=1" target="_blank" title="Contact">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  Contact
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              一些博客/网址
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.try8.cn/" title="程序员网址大全" target="_blank">程序员网址大全</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.ruanyifeng.com/blog/" title="阮一峰的网络日志" target="_blank">阮一峰的网络日志</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.zhangxinxu.com/wordpress/" title="张鑫旭的博客" target="_blank">张鑫旭的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript" title="MDNDOS(js)" target="_blank">MDNDOS(js)</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/u/2fb92d7e3f03" title="我的简书(除外)" target="_blank">我的简书(除外)</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://cnodejs.org/" title="nodejs" target="_blank">nodejs</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.w3cplus.com/" title="W3Cplus" target="_blank">W3Cplus</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.qianduan.net/" title="前端观察" target="_blank">前端观察</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.cnblogs.com/peterli2013/archive/2014/01/22/3530070.html" title="值得收藏的前端大牛博客（推荐）" target="_blank">值得收藏的前端大牛博客（推荐）</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/sofish" title="sofish" target="_blank">sofish</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.zhaojie.me/" title="老赵点滴 - 追求编程之美" target="_blank">老赵点滴 - 追求编程之美</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.cnblogs.com/rubylouvre/" title="司徒正美" target="_blank">司徒正美</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://evanyou.me/" title="尤小右" target="_blank">尤小右</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>

     

  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">殖民</span>
 
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"left","bdTop":"178.5"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='https://sky-xsk.github.io/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>



<p style="margin:0">版权所有：殖民的博客</p>

<button onclick="TogetherJS(this); return false;" style="background:#FA5555;border:0; color:#ffffff;">获取实时帮助,耐心等待右下角的弹窗哦！</button>
</div>



<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


<script>
  /* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/. */

/*jshint scripturl:true */
(function () {
    
      var defaultConfiguration = {
        // Disables clicks for a certain element.
        // (e.g., 'canvas' would not show clicks on canvas elements.)
        // Setting this to true will disable clicks globally.
        dontShowClicks: false,
        // Experimental feature to echo clicks to certain elements across clients:
        cloneClicks: false,
        // Enable Mozilla or Google analytics on the page when TogetherJS is activated:
        // FIXME: these don't seem to be working, and probably should be removed in favor
        // of the hub analytics
        enableAnalytics: false,
        // The code to enable (this is defaulting to a Mozilla code):
        analyticsCode: "UA-35433268-28",
        // The base URL of the hub (gets filled in below):
        hubBase: null,
        // A function that will return the name of the user:
        getUserName: null,
        // A function that will return the color of the user:
        getUserColor: null,
        // A function that will return the avatar of the user:
        getUserAvatar: null,
        // The siteName is used in the walkthrough (defaults to document.title):
        siteName: null,
        // Whether to use the minimized version of the code (overriding the built setting)
        useMinimizedCode: undefined,
        // Any events to bind to
        on: {},
        // Hub events to bind to
        hub_on: {},
        // Enables the alt-T alt-T TogetherJS shortcut; however, this setting
        // must be enabled early as TogetherJSConfig_enableShortcut = true;
        enableShortcut: false,
        // The name of this tool as provided to users.  The UI is updated to use this.
        // Because of how it is used in text it should be a proper noun, e.g.,
        // "MySite's Collaboration Tool"
        toolName: null,
        // Used to auto-start TogetherJS with a {prefix: pageName, max: participants}
        // Also with findRoom: "roomName" it will connect to the given room name
        findRoom: null,
        // If true, starts TogetherJS automatically (of course!)
        autoStart: false,
        // If true, then the "Join TogetherJS Session?" confirmation dialog
        // won't come up
        suppressJoinConfirmation: false,
        // If true, then the "Invite a friend" window won't automatically come up
        suppressInvite: false,
        // A room in which to find people to invite to this session,
        inviteFromRoom: null,
        // This is used to keep sessions from crossing over on the same
        // domain, if for some reason you want sessions that are limited
        // to only a portion of the domain:
        storagePrefix: "togetherjs",
        // When true, we treat the entire URL, including the hash, as the identifier
        // of the page; i.e., if you one person is on `http://example.com/#view1`
        // and another person is at `http://example.com/#view2` then these two people
        // are considered to be at completely different URLs
        includeHashInUrl: false,
        // When true, the WebRTC-based mic/chat will be disabled
        disableWebRTC: false,
        // When true, youTube videos will synchronize
        youtube: true,
        // Ignores the following console messages, disables all messages if set to true
        ignoreMessages: ["cursor-update", "keydown", "scroll-update"],
        // Ignores the following forms (will ignore all forms if set to true):
        ignoreForms: [":password"]
      };
    
      var styleSheet = "/togetherjs/togetherjs.css";
    
      var baseUrl = "https://togetherjs.com";
      if (baseUrl == "__" + "baseUrl__") {
        // Reset the variable if it doesn't get substituted
        baseUrl = "";
      }
      // True if this file should use minimized sub-resources:
      var min = "yes" == "__" + "min__" ? false : "yes" == "yes";
    
      var baseUrlOverride = localStorage.getItem("togetherjs.baseUrlOverride");
      if (baseUrlOverride) {
        try {
          baseUrlOverride = JSON.parse(baseUrlOverride);
        } catch (e) {
          baseUrlOverride = null;
        }
        if ((! baseUrlOverride) || baseUrlOverride.expiresAt < Date.now()) {
          // Ignore because it has expired
          localStorage.removeItem("togetherjs.baseUrlOverride");
        } else {
          baseUrl = baseUrlOverride.baseUrl;
          var logger = console.warn || console.log;
          logger.call(console, "Using TogetherJS baseUrlOverride:", baseUrl);
          logger.call(console, "To undo run: localStorage.removeItem('togetherjs.baseUrlOverride')");
        }
      }
    
      var configOverride = localStorage.getItem("togetherjs.configOverride");
      if (configOverride) {
        try {
          configOverride = JSON.parse(configOverride);
        } catch (e) {
          configOverride = null;
        }
        if ((! configOverride) || configOverride.expiresAt < Date.now()) {
          localStorage.removeItem("togetherjs.configOverride");
        } else {
          var shownAny = false;
          for (var attr in configOverride) {
            if (attr == "expiresAt" || ! configOverride.hasOwnProperty(attr)) {
              continue;
            }
            if (! shownAny) {
              console.warn("Using TogetherJS configOverride");
              console.warn("To undo run: localStorage.removeItem('togetherjs.configOverride')");
            }
            window["TogetherJSConfig_" + attr] = configOverride[attr];
            console.log("Config override:", attr, "=", configOverride[attr]);
          }
        }
      }
    
      var version = "unknown";
      // FIXME: we could/should use a version from the checkout, at least
      // for production
      var cacheBust = "";
      if ((! cacheBust) || cacheBust == "") {
        cacheBust = Date.now() + "";
      } else {
        version = cacheBust;
      }
    
      // Make sure we have all of the console.* methods:
      if (typeof console == "undefined") {
        console = {};
      }
      if (! console.log) {
        console.log = function () {};
      }
      ["debug", "info", "warn", "error"].forEach(function (method) {
        if (! console[method]) {
          console[method] = console.log;
        }
      });
    
      if (! baseUrl) {
        var scripts = document.getElementsByTagName("script");
        for (var i=0; i<scripts.length; i++) {
          var src = scripts[i].src;
          if (src && src.search(/togetherjs.js(\?.*)?$/) !== -1) {
            baseUrl = src.replace(/\/*togetherjs.js(\?.*)?$/, "");
            console.warn("Detected baseUrl as", baseUrl);
            break;
          } else if (src && src.search(/togetherjs-min.js(\?.*)?$/) !== -1) {
            baseUrl = src.replace(/\/*togetherjs-min.js(\?.*)?$/, "");
            console.warn("Detected baseUrl as", baseUrl);
            break;
          }
        }
      }
      if (! baseUrl) {
        console.warn("Could not determine TogetherJS's baseUrl (looked for a <script> with togetherjs.js and togetherjs-min.js)");
      }
    
      function addStyle() {
        var existing = document.getElementById("togetherjs-stylesheet");
        if (! existing) {
          var link = document.createElement("link");
          link.id = "togetherjs-stylesheet";
          link.setAttribute("rel", "stylesheet");
          link.href = baseUrl + styleSheet + "?bust=" + cacheBust;
          document.head.appendChild(link);
        }
      }
    
      function addScript(url) {
        var script = document.createElement("script");
        script.src = baseUrl + url + "?bust=" + cacheBust;
        document.head.appendChild(script);
      }
    
      var TogetherJS = window.TogetherJS = function TogetherJS(event) {
        if (TogetherJS.running) {
          var session = TogetherJS.require("session");
          session.close();
          return;
        }
        TogetherJS.startup.button = null;
        try {
          if (event && typeof event == "object") {
            if (event.target && typeof event) {
              TogetherJS.startup.button = event.target;
            } else if (event.nodeType == 1) {
              TogetherJS.startup.button = event;
            } else if (event[0] && event[0].nodeType == 1) {
              // Probably a jQuery element
              TogetherJS.startup.button = event[0];
            }
          }
        } catch (e) {
          console.warn("Error determining starting button:", e);
        }
        if (window.TowTruckConfig) {
          console.warn("TowTruckConfig is deprecated; please use TogetherJSConfig");
          if (window.TogetherJSConfig) {
            console.warn("Ignoring TowTruckConfig in favor of TogetherJSConfig");
          } else {
            window.TogetherJSConfig = TowTruckConfig;
          }
        }
        if (window.TogetherJSConfig && (! window.TogetherJSConfig.loaded)) {
          TogetherJS.config(window.TogetherJSConfig);
          window.TogetherJSConfig.loaded = true;
        }
    
        // This handles loading configuration from global variables.  This
        // includes TogetherJSConfig_on_*, which are attributes folded into
        // the "on" configuration value.
        var attr;
        var attrName;
        var globalOns = {};
        for (attr in window) {
          if (attr.indexOf("TogetherJSConfig_on_") === 0) {
            attrName = attr.substr(("TogetherJSConfig_on_").length);
            globalOns[attrName] = window[attr];
          } else if (attr.indexOf("TogetherJSConfig_") === 0) {
            attrName = attr.substr(("TogetherJSConfig_").length);
            TogetherJS.config(attrName, window[attr]);
          } else if (attr.indexOf("TowTruckConfig_on_") === 0) {
            attrName = attr.substr(("TowTruckConfig_on_").length);
            console.warn("TowTruckConfig_* is deprecated, please rename", attr, "to TogetherJSConfig_on_" + attrName);
            globalOns[attrName] = window[attr];
          } else if (attr.indexOf("TowTruckConfig_") === 0) {
            attrName = attr.substr(("TowTruckConfig_").length);
            console.warn("TowTruckConfig_* is deprecated, please rename", attr, "to TogetherJSConfig_" + attrName);
            TogetherJS.config(attrName, window[attr]);
          }
    
    
        }
        // FIXME: copy existing config?
        // FIXME: do this directly in TogetherJS.config() ?
        // FIXME: close these configs?
        var ons = TogetherJS.config.get("on");
        for (attr in globalOns) {
          if (globalOns.hasOwnProperty(attr)) {
            // FIXME: should we avoid overwriting?  Maybe use arrays?
            ons[attr] = globalOns[attr];
          }
        }
        TogetherJS.config("on", ons);
        for (attr in ons) {
          TogetherJS.on(attr, ons[attr]);
        }
        var hubOns = TogetherJS.config.get("hub_on");
        if (hubOns) {
          for (attr in hubOns) {
            if (hubOns.hasOwnProperty(attr)) {
              TogetherJS.hub.on(attr, hubOns[attr]);
            }
          }
        }
    
        if (! TogetherJS.startup.reason) {
          // Then a call to TogetherJS() from a button must be started TogetherJS
          TogetherJS.startup.reason = "started";
        }
    
        // FIXME: maybe I should just test for TogetherJS.require:
        if (TogetherJS._loaded) {
          var session = TogetherJS.require("session");
          addStyle();
          session.start();
          return;
        }
        // A sort of signal to session.js to tell it to actually
        // start itself (i.e., put up a UI and try to activate)
        TogetherJS.startup._launch = true;
    
        addStyle();
        var minSetting = TogetherJS.config.get("useMinimizedCode");
        TogetherJS.config.close("useMinimizedCode");
        if (minSetting !== undefined) {
          min = !! minSetting;
        }
        var requireConfig = TogetherJS._extend(TogetherJS.requireConfig);
        var deps = ["session", "jquery"];
        function callback(session, jquery) {
          TogetherJS._loaded = true;
          if (! min) {
            TogetherJS.require = require.config({context: "togetherjs"});
            TogetherJS._requireObject = require;
          }
        }
        if (! min) {
          if (typeof require == "function") {
            if (! require.config) {
              console.warn("The global require (", require, ") is not requirejs; please use togetherjs-min.js");
              throw new Error("Conflict with window.require");
            }
            TogetherJS.require = require.config(requireConfig);
          }
        }
        if (typeof TogetherJS.require == "function") {
          // This is an already-configured version of require
          TogetherJS.require(deps, callback);
        } else {
          requireConfig.deps = deps;
          requireConfig.callback = callback;
          if (! min) {
            window.require = requireConfig;
          }
        }
        if (min) {
          addScript("/togetherjs/togetherjsPackage.js");
        } else {
          addScript("/togetherjs/libs/require.js");
        }
      };
    
      TogetherJS.pageLoaded = Date.now();
    
      TogetherJS._extend = function (base, extensions) {
        if (! extensions) {
          extensions = base;
          base = {};
        }
        for (var a in extensions) {
          if (extensions.hasOwnProperty(a)) {
            base[a] = extensions[a];
          }
        }
        return base;
      };
    
      TogetherJS._startupInit = {
        // What element, if any, was used to start the session:
        button: null,
        // The startReason is the reason TogetherJS was started.  One of:
        //   null: not started
        //   started: hit the start button (first page view)
        //   joined: joined the session (first page view)
        reason: null,
        // Also, the session may have started on "this" page, or maybe is continued
        // from a past page.  TogetherJS.continued indicates the difference (false the
        // first time TogetherJS is started or joined, true on later page loads).
        continued: false,
        // This is set to tell the session what shareId to use, if the boot
        // code knows (mostly because the URL indicates the id).
        _joinShareId: null,
        // This tells session to start up immediately (otherwise it would wait
        // for session.start() to be run)
        _launch: false
      };
      TogetherJS.startup = TogetherJS._extend(TogetherJS._startupInit);
      TogetherJS.running = false;
    
      TogetherJS.requireConfig = {
        context: "togetherjs",
        baseUrl: baseUrl + "/togetherjs",
        urlArgs: "bust=" + cacheBust,
        paths: {
          jquery: "libs/jquery-1.8.3.min",
          walkabout: "libs/walkabout/walkabout",
          esprima: "libs/walkabout/lib/esprima",
          falafel: "libs/walkabout/lib/falafel",
          tinycolor: "libs/tinycolor",
          whrandom: "libs/whrandom/random"
        }
      };
    
      TogetherJS._mixinEvents = function (proto) {
        proto.on = function on(name, callback) {
          if (typeof callback != "function") {
            console.warn("Bad callback for", this, ".once(", name, ", ", callback, ")");
            throw "Error: .once() called with non-callback";
          }
          if (name.search(" ") != -1) {
            var names = name.split(/ +/g);
            names.forEach(function (n) {
              this.on(n, callback);
            }, this);
            return;
          }
          if (this._knownEvents && this._knownEvents.indexOf(name) == -1) {
            var thisString = "" + this;
            if (thisString.length > 20) {
              thisString = thisString.substr(0, 20) + "...";
            }
            console.warn(thisString + ".on('" + name + "', ...): unknown event");
            if (console.trace) {
              console.trace();
            }
          }
          if (! this._listeners) {
            this._listeners = {};
          }
          if (! this._listeners[name]) {
            this._listeners[name] = [];
          }
          if (this._listeners[name].indexOf(callback) == -1) {
            this._listeners[name].push(callback);
          }
        };
        proto.once = function once(name, callback) {
          if (typeof callback != "function") {
            console.warn("Bad callback for", this, ".once(", name, ", ", callback, ")");
            throw "Error: .once() called with non-callback";
          }
          var attr = "onceCallback_" + name;
          // FIXME: maybe I should add the event name to the .once attribute:
          if (! callback[attr]) {
            callback[attr] = function onceCallback() {
              callback.apply(this, arguments);
              this.off(name, onceCallback);
              delete callback[attr];
            };
          }
          this.on(name, callback[attr]);
        };
        proto.off = proto.removeListener = function off(name, callback) {
          if (this._listenerOffs) {
            // Defer the .off() call until the .emit() is done.
            this._listenerOffs.push([name, callback]);
            return;
          }
          if (name.search(" ") != -1) {
            var names = name.split(/ +/g);
            names.forEach(function (n) {
              this.off(n, callback);
            }, this);
            return;
          }
          if ((! this._listeners) || ! this._listeners[name]) {
            return;
          }
          var l = this._listeners[name], _len = l.length;
          for (var i=0; i<_len; i++) {
            if (l[i] == callback) {
              l.splice(i, 1);
              break;
            }
          }
        };
        proto.emit = function emit(name) {
          var offs = this._listenerOffs = [];
          if ((! this._listeners) || ! this._listeners[name]) {
            return;
          }
          var args = Array.prototype.slice.call(arguments, 1);
          var l = this._listeners[name];
          l.forEach(function (callback) {
    
            callback.apply(this, args);
          }, this);
          delete this._listenerOffs;
          if (offs.length) {
            offs.forEach(function (item) {
              this.off(item[0], item[1]);
            }, this);
          }
    
        };
        return proto;
      };
    
      /* This finalizes the unloading of TogetherJS, including unloading modules */
      TogetherJS._teardown = function () {
        var requireObject = TogetherJS._requireObject || window.require;
        // FIXME: this doesn't clear the context for min-case
        if (requireObject.s && requireObject.s.contexts) {
          delete requireObject.s.contexts.togetherjs;
        }
        TogetherJS._loaded = false;
        TogetherJS.startup = TogetherJS._extend(TogetherJS._startupInit);
        TogetherJS.running = false;
      };
    
      TogetherJS._mixinEvents(TogetherJS);
      TogetherJS._knownEvents = ["ready", "close"];
      TogetherJS.toString = function () {
        return "TogetherJS";
      };
    
      var defaultHubBase = "https://hub.togetherjs.com";
      if (defaultHubBase == "__" + "hubUrl"+ "__") {
        // Substitution wasn't made
        defaultHubBase = "https://hub.togetherjs.mozillalabs.com";
      }
      defaultConfiguration.hubBase = defaultHubBase;
    
      TogetherJS._configuration = {};
      TogetherJS._defaultConfiguration = defaultConfiguration;
      TogetherJS._configTrackers = {};
      TogetherJS._configClosed = {};
    
      /* TogetherJS.config(configurationObject)
         or: TogetherJS.config(configName, value)
    
         Adds configuration to TogetherJS.  You may also set the global variable TogetherJSConfig
         and when TogetherJS is started that configuration will be loaded.
    
         Unknown configuration values will lead to console error messages.
         */
      TogetherJS.config = function (name, maybeValue) {
        var settings;
        if (arguments.length == 1) {
          if (typeof name != "object") {
            throw new Error('TogetherJS.config(value) must have an object value (not: ' + name + ')');
          }
          settings = name;
        } else {
          settings = {};
          settings[name] = maybeValue;
        }
        var i;
        var tracker;
        for (var attr in settings) {
          if (settings.hasOwnProperty(attr)) {
            if (TogetherJS._configClosed[attr] && TogetherJS.running) {
              throw new Error("The configuration " + attr + " is finalized and cannot be changed");
            }
          }
        }
        for (var attr in settings) {
          if (! settings.hasOwnProperty(attr)) {
            continue;
          }
          if (attr == "loaded" || attr == "callToStart") {
            continue;
          }
          if (! TogetherJS._defaultConfiguration.hasOwnProperty(attr)) {
            console.warn("Unknown configuration value passed to TogetherJS.config():", attr);
          }
          var previous = TogetherJS._configuration[attr];
          var value = settings[attr];
          TogetherJS._configuration[attr] = value;
          var trackers = TogetherJS._configTrackers[name] || [];
          var failed = false;
          for (i=0; i<trackers.length; i++) {
            try {
              tracker = trackers[i];
              tracker(value, previous);
            } catch (e) {
              console.warn("Error setting configuration", name, "to", value,
                           ":", e, "; reverting to", previous);
              failed = true;
              break;
            }
          }
          if (failed) {
            TogetherJS._configuration[attr] = previous;
            for (i=0; i<trackers.length; i++) {
              try {
                tracker = trackers[i];
                tracker(value);
              } catch (e) {
                console.warn("Error REsetting configuration", name, "to", previous,
                             ":", e, "(ignoring)");
              }
            }
          }
        }
      };
    
      TogetherJS.config.get = function (name) {
        var value = TogetherJS._configuration[name];
        if (value === undefined) {
          if (! TogetherJS._defaultConfiguration.hasOwnProperty(name)) {
            console.error("Tried to load unknown configuration value:", name);
          }
          value = TogetherJS._defaultConfiguration[name];
        }
        return value;
      };
    
      TogetherJS.config.track = function (name, callback) {
        if (! TogetherJS._defaultConfiguration.hasOwnProperty(name)) {
          throw new Error("Configuration is unknown: " + name);
        }
        callback(TogetherJS.config.get(name));
        if (! TogetherJS._configTrackers[name]) {
          TogetherJS._configTrackers[name] = [];
        }
        TogetherJS._configTrackers[name].push(callback);
        return callback;
      };
    
      TogetherJS.config.close = function (name) {
        if (! TogetherJS._defaultConfiguration.hasOwnProperty(name)) {
          throw new Error("Configuration is unknown: " + name);
        }
        TogetherJS._configClosed[name] = true;
      };
    
      TogetherJS.reinitialize = function () {
        if (TogetherJS.running && typeof TogetherJS.require == "function") {
          TogetherJS.require(["session"], function (session) {
            session.emit("reinitialize");
          });
        }
        // If it's not set, TogetherJS has not been loaded, and reinitialization is not needed
      };
    
      TogetherJS.refreshUserData = function () {
        if (TogetherJS.running && typeof TogetherJS.require ==  "function") {
          TogetherJS.require(["session"], function (session) {
            session.emit("refresh-user-data");
          });
        }
      };
    
      // This should contain the output of "git describe --always --dirty"
      // FIXME: substitute this on the server (and update make-static-client)
      TogetherJS.version = version;
      TogetherJS.baseUrl = baseUrl;
    
      TogetherJS.hub = TogetherJS._mixinEvents({});
    
      TogetherJS._onmessage = function (msg) {
        var type = msg.type;
        if (type.search(/^app\./) === 0) {
          type = type.substr("app.".length);
        } else {
          type = "togetherjs." + type;
        }
        msg.type = type;
        TogetherJS.hub.emit(msg.type, msg);
      };
    
      TogetherJS.send = function (msg) {
        if (! TogetherJS.require) {
          throw "You cannot use TogetherJS.send() when TogetherJS is not running";
        }
        var session = TogetherJS.require("session");
        session.appSend(msg);
      };
    
      TogetherJS.shareUrl = function () {
        if (! TogetherJS.require) {
          return null;
        }
        var session = TogetherJS.require("session");
        return session.shareUrl();
      };
    
      var listener = null;
    
      TogetherJS.listenForShortcut = function () {
        console.warn("Listening for alt-T alt-T to start TogetherJS");
        TogetherJS.removeShortcut();
        listener = function listener(event) {
          if (event.which == 84 && event.altKey) {
            if (listener.pressed) {
              // Second hit
              TogetherJS();
            } else {
              listener.pressed = true;
            }
          } else {
            listener.pressed = false;
          }
        };
        TogetherJS.once("ready", TogetherJS.removeShortcut);
        document.addEventListener("keyup", listener, false);
      };
    
      TogetherJS.removeShortcut = function () {
        if (listener) {
          document.addEventListener("keyup", listener, false);
          listener = null;
        }
      };
    
      TogetherJS.config.track("enableShortcut", function (enable, previous) {
        if (enable) {
          TogetherJS.listenForShortcut();
        } else if (previous) {
          TogetherJS.removeShortcut();
        }
      });
    
      TogetherJS.checkForUsersOnChannel = function (address, callback) {
        if (address.search(/^https?:/i) === 0) {
          address = address.replace(/^http/i, 'ws');
        }
        var socket = new WebSocket(address);
        var gotAnswer = false;
        socket.onmessage = function (event) {
          var msg = JSON.parse(event.data);
          if (msg.type != "init-connection") {
            console.warn("Got unexpected first message (should be init-connection):", msg);
            return;
          }
          if (gotAnswer) {
            console.warn("Somehow received two responses from channel; ignoring second");
            socket.close();
            return;
          }
          gotAnswer = true;
          socket.close();
          callback(msg.peerCount);
        };
        socket.onclose = socket.onerror = function () {
          if (! gotAnswer) {
            console.warn("Socket was closed without receiving answer");
            gotAnswer = true;
            callback(undefined);
          }
        };
      };
    
      // It's nice to replace this early, before the load event fires, so we conflict
      // as little as possible with the app we are embedded in:
      var hash = location.hash.replace(/^#/, "");
      var m = /&?togetherjs=([^&]*)/.exec(hash);
      if (m) {
        TogetherJS.startup._joinShareId = m[1];
        TogetherJS.startup.reason = "joined";
        var newHash = hash.substr(0, m.index) + hash.substr(m.index + m[0].length);
        location.hash = newHash;
      }
      if (window._TogetherJSShareId) {
        // A weird hack for something the addon does, to force a shareId.
        // FIXME: probably should remove, it's a wonky feature.
        TogetherJS.startup._joinShareId = window._TogetherJSShareId;
        delete window._TogetherJSShareId;
      }
    
      function conditionalActivate() {
        if (window.TogetherJSConfig_noAutoStart) {
          return;
        }
        // A page can define this function to defer TogetherJS from starting
        var callToStart = window.TogetherJSConfig_callToStart;
        if (! callToStart && window.TowTruckConfig_callToStart) {
          callToStart = window.TowTruckConfig_callToStart;
          console.warn("Please rename TowTruckConfig_callToStart to TogetherJSConfig_callToStart");
        }
        if (window.TogetherJSConfig && window.TogetherJSConfig.callToStart) {
          callToStart = window.TogetherJSConfig.callToStart;
        }
        if (callToStart) {
          // FIXME: need to document this:
          callToStart(onload);
        } else {
          onload();
        }
      }
    
      // FIXME: can we push this up before the load event?
      // Do we need to wait at all?
      function onload() {
        if (TogetherJS.startup._joinShareId) {
          TogetherJS();
        } else if (window._TogetherJSBookmarklet) {
          delete window._TogetherJSBookmarklet;
          TogetherJS();
        } else {
          // FIXME: this doesn't respect storagePrefix:
          var key = "togetherjs-session.status";
          var value = sessionStorage.getItem(key);
          if (value) {
            value = JSON.parse(value);
            if (value && value.running) {
              TogetherJS.startup.continued = true;
              TogetherJS.startup.reason = value.startupReason;
              TogetherJS();
            }
          } else if (window.TogetherJSConfig_autoStart ||
                     (window.TogetherJSConfig && window.TogetherJSConfig.autoStart)) {
            TogetherJS.startup.reason = "joined";
            TogetherJS();
          }
        }
      }
    
      conditionalActivate();
    
      // FIXME: wait until load event to double check if this gets set?
      if (window.TogetherJSConfig_enableShortcut) {
        TogetherJS.listenForShortcut();
      }
    
      // For compatibility:
      window.TowTruck = TogetherJS;
    
    })();
</script>
        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数 <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      次
    </span>
  

  
    <span class="site-pv">
      本站总访问量 <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
